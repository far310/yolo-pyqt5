(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2118:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>J});var a=t(2432),n=t(364);function r(e){let{children:s,className:t="",...n}=e;return(0,a.jsx)("div",{className:"card ".concat(t),...n,children:s})}function i(e){let{children:s,className:t="",...n}=e;return(0,a.jsx)("div",{className:"card-header ".concat(t),...n,children:s})}function l(e){let{children:s,className:t="",...n}=e;return(0,a.jsx)("div",{className:"card-content ".concat(t),...n,children:s})}function c(e){let{children:s,className:t="",...n}=e;return(0,a.jsx)("h3",{className:"card-title ".concat(t),...n,children:s})}function o(e){let{className:s="",...t}=e;return(0,a.jsx)("input",{className:"input ".concat(s),...t})}function d(e){let{children:s,className:t="",...n}=e;return(0,a.jsx)("label",{className:"label ".concat(t),...n,children:s})}function h(e){let{children:s,className:t="",variant:n="default",size:r="default",disabled:i=!1,...l}=e;return(0,a.jsx)("button",{className:"".concat("btn"," ").concat("btn-".concat(n)," ").concat("btn-".concat(r)," ").concat(i?"btn-disabled":""," ").concat(t),disabled:i,...l,children:s})}function u(e){let{className:s="",size:t=16}=e;return(0,a.jsxs)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),(0,a.jsx)("circle",{cx:"12",cy:"13",r:"3"})]})}function m(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polygon",{points:"5,3 19,12 5,21"})})}function x(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"})})}function g(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M12 2a3 3 0 0 0-3 3 3 3 0 0 0-3 3v1a3 3 0 0 0-3 3 3 3 0 0 0 3 3v1a3 3 0 0 0 3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0 3-3v-1a3 3 0 0 0 3-3 3 3 0 0 0-3-3V8a3 3 0 0 0-3-3 3 3 0 0 0-3-3z"})})}function p(e){let{className:s="",size:t=16}=e;return(0,a.jsxs)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,a.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}function j(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polygon",{points:"13,2 3,14 12,14 11,22 21,10 12,10"})})}function f(e){let{className:s="",size:t=16}=e;return(0,a.jsxs)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),(0,a.jsx)("polyline",{points:"7,10 12,15 17,10"}),(0,a.jsx)("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]})}function y(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})})}function v(e){let{className:s="",size:t=16}=e;return(0,a.jsxs)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("polyline",{points:"1,4 1,10 7,10"}),(0,a.jsx)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]})}function b(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polyline",{points:"6,9 12,15 18,9"})})}function N(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polyline",{points:"18,15 12,9 6,15"})})}function w(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polyline",{points:"9,18 15,12 9,6"})})}function C(e){let{className:s="",size:t=16}=e;return(0,a.jsx)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,a.jsx)("polyline",{points:"15,18 9,12 15,6"})})}function k(e){let{className:s="",size:t=16}=e;return(0,a.jsxs)("svg",{className:"icon ".concat(s),width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",ry:"2"}),(0,a.jsx)("rect",{x:"9",y:"9",width:"6",height:"6"}),(0,a.jsx)("line",{x1:"9",y1:"1",x2:"9",y2:"4"}),(0,a.jsx)("line",{x1:"15",y1:"1",x2:"15",y2:"4"}),(0,a.jsx)("line",{x1:"9",y1:"20",x2:"9",y2:"23"}),(0,a.jsx)("line",{x1:"15",y1:"20",x2:"15",y2:"23"}),(0,a.jsx)("line",{x1:"20",y1:"9",x2:"23",y2:"9"}),(0,a.jsx)("line",{x1:"20",y1:"14",x2:"23",y2:"14"}),(0,a.jsx)("line",{x1:"1",y1:"9",x2:"4",y2:"9"}),(0,a.jsx)("line",{x1:"1",y1:"14",x2:"4",y2:"14"})]})}function S(e){let{currentModelPath:s,modelLoading:t,onModelChange:u}=e,[m,x]=(0,n.useState)(s),p=()=>{m.trim()&&u(m.trim())};return(0,a.jsxs)(r,{children:[(0,a.jsx)(i,{className:"pb-3",children:(0,a.jsxs)(c,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(g,{className:"w-5 h-5"}),"AI模型设置"]})}),(0,a.jsxs)(l,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d,{htmlFor:"model-path",children:"模型文件路径"}),(0,a.jsx)(o,{id:"model-path",type:"text",value:m,onChange:e=>x(e.target.value),onKeyPress:e=>{"Enter"===e.key&&p()},placeholder:"例如: ./model/best_float32-2.tflite",className:"mt-2",disabled:t})]}),(0,a.jsx)(h,{onClick:p,disabled:t||!m.trim(),className:"w-full",size:"sm",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k,{className:"w-4 h-4 mr-2 animate-spin"}),"加载中..."]}):"加载模型"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:"当前模型"}),t&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-600",children:[(0,a.jsx)(k,{className:"w-3 h-3 animate-spin"}),"加载中..."]})]}),(0,a.jsx)("div",{className:"text-xs",children:(0,a.jsx)("div",{className:"text-gray-500 break-all",children:s||"未加载模型"})})]})]})]})}function P(e){let{selectedCamera:s,isStreaming:t,modelLoading:g,isStarting:p=!1,onCameraChange:j,onStartCamera:f,onStopCamera:y}=e,[v,b]=(0,n.useState)(s||"0"),N=e=>{let s=Number.parseInt(e);(""===e||!isNaN(s)&&s>=0&&s<=10)&&(b(e),j(e))};return(0,a.jsxs)(r,{children:[(0,a.jsx)(i,{className:"pb-3",children:(0,a.jsxs)(c,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(u,{className:"w-5 h-5"}),"摄像头控制"]})}),(0,a.jsxs)(l,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d,{htmlFor:"camera-index",children:"摄像头索引 (0-10)"}),(0,a.jsx)(o,{id:"camera-index",type:"text",value:v,onChange:e=>N(e.target.value),onKeyPress:e=>{/[0-9]/.test(e.key)||["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)||e.preventDefault()},placeholder:"输入摄像头索引，如: 0",className:"mt-2",maxLength:2,disabled:t}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"通常 0 为默认摄像头，1-10 为外接摄像头"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(h,{onClick:f,disabled:t||g||!v.trim()||p,className:"flex-1",size:"sm",children:[(0,a.jsx)(m,{className:"w-4 h-4 mr-1"}),p?"启动中...":"启动"]}),(0,a.jsxs)(h,{onClick:y,disabled:!t||p,variant:"outline",className:"flex-1 bg-transparent",size:"sm",children:[(0,a.jsx)(x,{className:"w-4 h-4 mr-1"}),"停止"]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:"摄像头状态"}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(p?"bg-yellow-500":t?"bg-green-500":"bg-red-500")})]}),(0,a.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:p?"正在启动摄像头 ".concat(v,"..."):t?"正在使用摄像头 ".concat(v):"摄像头未启动"})]})]})]})}var M=t(4454),z=t(2126),T=t(8441);function A(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,T.QP)((0,z.$)(s))}let R=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsxs)(M.bL,{ref:s,className:A("relative flex w-full touch-none select-none items-center",t),...n,children:[(0,a.jsx)(M.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,a.jsx)(M.Q6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(M.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});function _(e){let{id:s,checked:t,onCheckedChange:n,disabled:r=!1}=e;return(0,a.jsx)("div",{className:"switch ".concat(t?"switch-checked":""," ").concat(r?"switch-disabled":""),onClick:()=>{r||n(!t)},id:s,children:(0,a.jsx)("div",{className:"switch-thumb"})})}R.displayName=M.bL.displayName;let L=e=>{let{title:s,isCollapsed:t,onToggle:r}=e,i=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),r()},[r,s]);return(0,a.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors",onClick:i,role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),r())},children:[(0,a.jsx)("h4",{className:"text-sm font-medium pointer-events-none",children:s}),(0,a.jsx)("div",{className:"pointer-events-none",children:t?(0,a.jsx)(b,{className:"w-4 h-4"}):(0,a.jsx)(N,{className:"w-4 h-4"})})]})};function V(e){let{imageParams:s,collapsedSections:t,onParamsChange:u,onToggleSection:m,onResetParams:x}=e,g=(0,n.useCallback)((e,t)=>{u({...s,[e]:t})},[s,u]),p=(0,n.useCallback)((e,t,a)=>{g("srcPoints",{...s.srcPoints,[e]:{...s.srcPoints[e],[t]:a}})},[s.srcPoints,g]);return(0,a.jsxs)(r,{children:[(0,a.jsx)(i,{className:"pb-3",children:(0,a.jsxs)(c,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"图像处理参数"}),(0,a.jsxs)(h,{onClick:x,variant:"outline",size:"sm",children:[(0,a.jsx)(v,{className:"w-4 h-4 mr-1"}),"重置"]})]})}),(0,a.jsxs)(l,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"基础调整",isCollapsed:t.basicAdjustment,onToggle:()=>m("basicAdjustment")}),!t.basicAdjustment&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["对比度: ",s.contrast,"%"]}),(0,a.jsx)(R,{value:[s.contrast],onValueChange:e=>{let[s]=e;return g("contrast",s)},min:0,max:200,step:1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["亮度: ",s.brightness,"%"]}),(0,a.jsx)(R,{value:[s.brightness],onValueChange:e=>{let[s]=e;return g("brightness",s)},min:0,max:200,step:1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["饱和度: ",s.saturation,"%"]}),(0,a.jsx)(R,{value:[s.saturation],onValueChange:e=>{let[s]=e;return g("saturation",s)},min:0,max:200,step:1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["模糊: ",s.blur]}),(0,a.jsx)(R,{value:[s.blur],onValueChange:e=>{let[s]=e;return g("blur",s)},min:0,max:10,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["延迟 (秒): ",s.delaySeconds]}),(0,a.jsx)(R,{value:[s.delaySeconds],onValueChange:e=>{let[s]=e;return g("delaySeconds",s)},min:.1,max:5,step:.1})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"检测阈值",isCollapsed:t.detectionThreshold,onToggle:()=>m("detectionThreshold")}),!t.detectionThreshold&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["目标阈值: ",s.objThresh,"%"]}),(0,a.jsx)(R,{value:[s.objThresh],onValueChange:e=>{let[s]=e;return g("objThresh",s)},min:0,max:100,step:1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["NMS阈值: ",s.nmsThresh,"%"]}),(0,a.jsx)(R,{value:[s.nmsThresh],onValueChange:e=>{let[s]=e;return g("nmsThresh",s)},min:0,max:100,step:1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["分数阈值: ",s.scoreThresh,"%"]}),(0,a.jsx)(R,{value:[s.scoreThresh],onValueChange:e=>{let[s]=e;return g("scoreThresh",s)},min:0,max:100,step:1})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"透视变换",isCollapsed:t.perspectiveTransform,onToggle:()=>m("perspectiveTransform")}),!t.perspectiveTransform&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_,{checked:s.perspectiveEnabled,onCheckedChange:e=>g("perspectiveEnabled",e)}),(0,a.jsx)(d,{children:"启用透视变换"})]}),s.perspectiveEnabled&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{children:"左上角"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o,{type:"number",placeholder:"X",value:s.srcPoints.topLeft.x,onChange:e=>p("topLeft","x",Number(e.target.value))}),(0,a.jsx)(o,{type:"number",placeholder:"Y",value:s.srcPoints.topLeft.y,onChange:e=>p("topLeft","y",Number(e.target.value))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{children:"右上角"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o,{type:"number",placeholder:"X",value:s.srcPoints.topRight.x,onChange:e=>p("topRight","x",Number(e.target.value))}),(0,a.jsx)(o,{type:"number",placeholder:"Y",value:s.srcPoints.topRight.y,onChange:e=>p("topRight","y",Number(e.target.value))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{children:"右下角"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o,{type:"number",placeholder:"X",value:s.srcPoints.bottomRight.x,onChange:e=>p("bottomRight","x",Number(e.target.value))}),(0,a.jsx)(o,{type:"number",placeholder:"Y",value:s.srcPoints.bottomRight.y,onChange:e=>p("bottomRight","y",Number(e.target.value))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{children:"左下角"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(o,{type:"number",placeholder:"X",value:s.srcPoints.bottomLeft.x,onChange:e=>p("bottomLeft","x",Number(e.target.value))}),(0,a.jsx)(o,{type:"number",placeholder:"Y",value:s.srcPoints.bottomLeft.y,onChange:e=>p("bottomLeft","y",Number(e.target.value))})]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"畸变矫正",isCollapsed:t.distortionCorrection,onToggle:()=>m("distortionCorrection")}),!t.distortionCorrection&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_,{checked:s.distortionEnabled,onCheckedChange:e=>g("distortionEnabled",e)}),(0,a.jsx)(d,{children:"启用畸变矫正"})]}),s.distortionEnabled&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["K1: ",s.distortionK1]}),(0,a.jsx)(R,{value:[s.distortionK1],onValueChange:e=>{let[s]=e;return g("distortionK1",s)},min:-100,max:100,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["K2: ",s.distortionK2]}),(0,a.jsx)(R,{value:[s.distortionK2],onValueChange:e=>{let[s]=e;return g("distortionK2",s)},min:-100,max:100,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["P1: ",s.distortionP1]}),(0,a.jsx)(R,{value:[s.distortionP1],onValueChange:e=>{let[s]=e;return g("distortionP1",s)},min:-1,max:1,step:.01})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["P2: ",s.distortionP2]}),(0,a.jsx)(R,{value:[s.distortionP2],onValueChange:e=>{let[s]=e;return g("distortionP2",s)},min:-1,max:1,step:.01})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["K3: ",s.distortionK3]}),(0,a.jsx)(R,{value:[s.distortionK3],onValueChange:e=>{let[s]=e;return g("distortionK3",s)},min:-100,max:100,step:.1})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"相机内参",isCollapsed:t.cameraIntrinsics,onToggle:()=>m("cameraIntrinsics")}),!t.cameraIntrinsics&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["焦距 fx: ",s.focalLengthX]}),(0,a.jsx)(R,{value:[s.focalLengthX],onValueChange:e=>{let[s]=e;return g("focalLengthX",s)},min:500,max:2e3,step:.01})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["焦距 fy: ",s.focalLengthY]}),(0,a.jsx)(R,{value:[s.focalLengthY],onValueChange:e=>{let[s]=e;return g("focalLengthY",s)},min:500,max:2e3,step:.01})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["主点 cx: ",s.principalPointX]}),(0,a.jsx)(R,{value:[s.principalPointX],onValueChange:e=>{let[s]=e;return g("principalPointX",s)},min:0,max:2e3,step:.01})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["主点 cy: ",s.principalPointY]}),(0,a.jsx)(R,{value:[s.principalPointY],onValueChange:e=>{let[s]=e;return g("principalPointY",s)},min:0,max:1500,step:.01})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"相机参数",isCollapsed:t.cameraParams,onToggle:()=>m("cameraParams")}),!t.cameraParams&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["相机高度 (cm): ",s.cameraHeight]}),(0,a.jsx)(R,{value:[s.cameraHeight],onValueChange:e=>{let[s]=e;return g("cameraHeight",s)},min:5,max:50,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["目标高度 (cm): ",s.targetHeight]}),(0,a.jsx)(R,{value:[s.targetHeight],onValueChange:e=>{let[s]=e;return g("targetHeight",s)},min:1,max:10,step:.1})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"背景图像设置",isCollapsed:t.backgroundImage,onToggle:()=>m("backgroundImage")}),!t.backgroundImage&&(0,a.jsx)("div",{className:"space-y-4 pl-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{children:"背景图像路径"}),(0,a.jsx)(o,{type:"text",placeholder:"例如: ./img/bg.jpg",value:s.backgroundImagePath,onChange:e=>g("backgroundImagePath",e.target.value),className:"w-full"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"用于异物检测的背景参考图像路径，支持相对路径和绝对路径"})]})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"尺寸分类",isCollapsed:t.sizeClassification,onToggle:()=>m("sizeClassification")}),!t.sizeClassification&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["汉堡最小面积 (cm): ",s.hamburgerSizeMjMin]}),(0,a.jsx)(R,{value:[s.hamburgerSizeMjMin],onValueChange:e=>{let[s]=e;return g("hamburgerSizeMjMin",s)},min:1,max:500,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["汉堡最大面积 (cm): ",s.hamburgerSizeMjMax]}),(0,a.jsx)(R,{value:[s.hamburgerSizeMjMax],onValueChange:e=>{let[s]=e;return g("hamburgerSizeMjMax",s)},min:1,max:500,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["汉堡最小尺寸 (cm): ",s.hamburgerSizeMin]}),(0,a.jsx)(R,{value:[s.hamburgerSizeMin],onValueChange:e=>{let[s]=e;return g("hamburgerSizeMin",s)},min:5,max:20,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["汉堡最大尺寸 (cm): ",s.hamburgerSizeMax]}),(0,a.jsx)(R,{value:[s.hamburgerSizeMax],onValueChange:e=>{let[s]=e;return g("hamburgerSizeMax",s)},min:10,max:25,step:.1})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(L,{title:"实际尺寸",isCollapsed:t.realSize,onToggle:()=>m("realSize")}),!t.realSize&&(0,a.jsxs)("div",{className:"space-y-4 pl-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["实际宽度 (cm): ",s.realWidthCm]}),(0,a.jsx)(R,{value:[s.realWidthCm],onValueChange:e=>{let[s]=e;return g("realWidthCm",s)},min:10,max:50,step:.1})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d,{children:["实际高度 (cm): ",s.realHeightCm]}),(0,a.jsx)(R,{value:[s.realHeightCm],onValueChange:e=>{let[s]=e;return g("realHeightCm",s)},min:10,max:30,step:.1})]})]})]})]})]})}function E(e){let{settings:s,onSettingsChange:t}=e,n=e=>{t({...s,...e})};return(0,a.jsxs)(r,{children:[(0,a.jsx)(i,{className:"pb-3",children:(0,a.jsxs)(c,{className:"flex items-center gap-2 text-lg",children:[(0,a.jsx)(p,{className:"w-5 h-5"}),"识别功能"]})}),(0,a.jsxs)(l,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(d,{htmlFor:"foreign-object",children:"异物识别"}),(0,a.jsx)(_,{id:"foreign-object",checked:s.foreignObjectDetection,onCheckedChange:e=>n({foreignObjectDetection:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(d,{htmlFor:"size-classification",children:"大中小识别"}),(0,a.jsx)(_,{id:"size-classification",checked:s.sizeClassification,onCheckedChange:e=>n({sizeClassification:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(d,{htmlFor:"height-correction",children:"高度补偿"}),(0,a.jsx)(_,{id:"height-correction",checked:s.heightCorrection,onCheckedChange:e=>n({heightCorrection:e})})]})]})]})}let I=(0,n.forwardRef)((e,s)=>{let{isStreaming:t,modelLoading:o,currentFrame:d,isSaving:m=!1,onSaveImage:x}=e,g=(0,n.useRef)(null),p=(0,n.useRef)(null),j=(0,n.useRef)(null);return(0,n.useEffect)(()=>{"function"==typeof s?s({video:g.current,canvas:p.current}):s&&(s.current={video:g.current,canvas:p.current})},[s]),(0,a.jsxs)(r,{children:[(0,a.jsx)(i,{className:"pb-3",children:(0,a.jsxs)(c,{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"实时图像"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[x&&(0,a.jsxs)(h,{onClick:x,disabled:!t||m,variant:"outline",size:"sm",children:[(0,a.jsx)(f,{className:"w-4 h-4 mr-1"}),m?"保存中...":"保存"]}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(t?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:t?"运行中":"已停止"})]})]})}),(0,a.jsx)(l,{children:(0,a.jsxs)("div",{className:"relative bg-black rounded-lg overflow-hidden w-full h-[520px]",children:[t&&d?(0,a.jsx)("img",{ref:j,src:d||"/placeholder.svg",alt:"Camera feed",className:"absolute inset-0 w-full h-full object-cover",onError:e=>{}}):(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(u,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg",children:"请启动摄像头开始识别"}),o&&(0,a.jsx)("p",{className:"text-sm text-blue-400 mt-2",children:"模型加载中，请稍候..."})]})}),(0,a.jsx)("video",{ref:g,autoPlay:!0,playsInline:!0,muted:!0,className:"absolute inset-0 w-full h-full object-cover",style:{display:"none"}}),(0,a.jsx)("canvas",{ref:p,className:"absolute inset-0 w-full h-full object-cover",style:{display:"none"}})]})})]})});function W(e){let{variant:s="default",children:t,className:n=""}=e;return(0,a.jsx)("span",{className:"badge badge-".concat(s," ").concat(n),children:t})}function H(e){let{objects:s,isExporting:t=!1,onExportReport:n}=e;return(0,a.jsxs)(r,{children:[(0,a.jsx)(i,{className:"pb-3",children:(0,a.jsxs)(c,{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j,{className:"w-5 h-5"}),"检测结果"]}),n&&s.length>0&&(0,a.jsxs)(h,{onClick:n,disabled:t,variant:"outline",size:"sm",children:[(0,a.jsx)(y,{className:"w-4 h-4 mr-1"}),t?"导出中...":"导出报告"]})]})}),(0,a.jsx)(l,{children:s.length>0?(0,a.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(W,{variant:"异物"===e.type||"缺陷"===e.type?"destructive":"default",children:e.type}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["置信度: ",(100*e.confidence).toFixed(1),"%"]}),(0,a.jsx)(W,{variant:"outline",children:"small"===e.size?"小":"medium"===e.size?"中":"大"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["位置: (",e.x.toFixed(0),", ",e.y.toFixed(0),")"]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(p,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{children:"暂无检测结果"}),(0,a.jsx)("p",{className:"text-sm",children:"启用识别功能并开始检测"})]})})]})}function K(e){let{objectCount:s,anomalyCount:t,averageConfidence:n,fps:i,isStreaming:c}=e;return(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsx)(r,{children:(0,a.jsxs)(l,{className:"p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:s}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"检测对象"})]})}),(0,a.jsx)(r,{children:(0,a.jsxs)(l,{className:"p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:t}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"异常数量"})]})}),(0,a.jsx)(r,{children:(0,a.jsxs)(l,{className:"p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:s>0?"".concat(n.toFixed(1),"%"):"0%"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"平均置信度"})]})}),(0,a.jsx)(r,{children:(0,a.jsxs)(l,{className:"p-4 text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:[c?i:0," FPS"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"处理帧率"})]})})]})}I.displayName="VideoDisplay";class D{isWebChannelAvailable(){var e;return"qt"in window&&(null===(e=window.qt)||void 0===e?void 0:e.webChannelTransport)}async callPythonMethod(e){for(var s=arguments.length,t=Array(s>1?s-1:0),a=1;a<s;a++)t[a-1]=arguments[a];if(!this.isWebChannelAvailable())return this.getMockResponse(e,...t);try{if(window.pyapi||await this.initWebChannel(),!window.pyapi||!window.pyapi[e])throw Error("Method ".concat(e," not available on Python API"));let s=await window.pyapi[e](...t);if("string"==typeof s)try{return JSON.parse(s)}catch(e){}return s}catch(s){return this.getMockResponse(e,...t)}}async initWebChannel(){return new Promise((e,s)=>{let t=setTimeout(()=>{s(Error("WebChannel initialization timeout"))},1e4),a=()=>{if(window.qt&&window.qt.webChannelTransport)try{if(void 0===window.QWebChannel){let a=document.createElement("script");a.src="qrc:///qtwebchannel/qwebchannel.js",a.onload=()=>{this.createWebChannel(e,s,t)},a.onerror=()=>{s(Error("Failed to load QWebChannel script"))},document.head.appendChild(a)}else this.createWebChannel(e,s,t)}catch(e){setTimeout(a,100)}else setTimeout(a,100)};a()})}createWebChannel(e,s,t){try{new window.QWebChannel(window.qt.webChannelTransport,s=>{clearTimeout(t),window.pyapi=s.objects.pyapi,e()})}catch(e){clearTimeout(t),s(e)}}getMockResponse(e){for(var s=arguments.length,t=Array(s>1?s-1:0),a=1;a<s;a++)t[a-1]=arguments[a];switch(e){case"start_camera":return{success:!0,message:"摄像头 ".concat(t[0]," 启动成功 (模拟)")};case"stop_camera":return{success:!0,message:"摄像头已停止 (模拟)"};case"load_model":return{success:!0,message:"模型加载成功: ".concat(t[0]," (模拟)")};case"set_image_params":return{success:!0,message:"图像参数已更新 (模拟)"};case"set_recognition_settings":return{success:!0,message:"识别设置已更新 (模拟)"};case"get_current_frame":return{success:!0,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",timestamp:Date.now()};case"get_detection_results":return{objects:[{id:"obj_".concat(Date.now()),type:"Hamburger",confidence:.85,size:"medium",x:100,y:150,width:80,height:60}]};case"save_image":return{success:!0,message:"图像已保存 (模拟)"};case"export_report":return{success:!0,message:"报告已导出 (模拟)"};case"get_system_status":return{fps:30,cpuUsage:45,memoryUsage:60,gpuUsage:0};default:return{success:!0,message:"操作完成 (模拟)"}}}async startCamera(e){return await this.callPythonMethod("start_camera",e)}async stopCamera(){return await this.callPythonMethod("stop_camera")}async loadModel(e){return await this.callPythonMethod("load_model",e)}async setImageParams(e){return await this.callPythonMethod("set_image_params",JSON.stringify(e))}async setRecognitionSettings(e){return await this.callPythonMethod("set_recognition_settings",JSON.stringify(e))}async getCurrentFrame(){return await this.callPythonMethod("get_current_frame")||{success:!1,error:"Failed to get frame"}}async getDetectionResults(){return await this.callPythonMethod("get_detection_results")||{objects:[]}}async saveImage(e){return await this.callPythonMethod("save_image",e||"")}async exportReport(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json";return await this.callPythonMethod("export_report",e)}async getSystemStatus(){return await this.callPythonMethod("get_system_status")||{fps:0,cpuUsage:0,memoryUsage:0,gpuUsage:0}}async testConnection(){try{return await this.getSystemStatus(),!0}catch(e){return!1}}}let F=new D;window.addEventListener("DOMContentLoaded",async()=>{await F.testConnection()});var U=t(9088),B=t(6992),Y=t(1844);U.Kq,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(U.LM,{ref:s,className:A("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...n})}).displayName=U.LM.displayName;let X=(0,B.F)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}});function O(e){let{message:s,type:t="info",duration:r=3e3,onClose:i}=e,[l,c]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=setTimeout(()=>{c(!1),i&&setTimeout(i,300)},r);return()=>clearTimeout(e)},[r,i]),(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow-lg transition-all duration-300 ".concat(l?"opacity-100 translate-y-0":"opacity-0 -translate-y-2"," ").concat((()=>{switch(t){case"success":return"bg-green-500 text-white";case"error":return"bg-red-500 text-white";default:return"bg-blue-500 text-white"}})()),children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:s}),(0,a.jsx)("button",{onClick:()=>{c(!1),i&&setTimeout(i,300)},className:"ml-2 text-white hover:text-gray-200",children:"\xd7"})]})})}function q(e){let{toasts:s,onRemoveToast:t}=e;return(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:s.map(e=>(0,a.jsx)(O,{message:e.message,type:e.type,duration:e.duration,onClose:()=>t(e.id)},e.id))})}function J(){let e=(0,n.useRef)({video:null,canvas:null}),{isConnected:s,systemStatus:t,currentFrame:r,detectedObjects:i,startCamera:l,stopCamera:c,loadModel:o,updateImageParams:d,updateRecognitionSettings:u,saveImage:m,exportReport:x}=function(){let[e,s]=(0,n.useState)(!1),[t,a]=(0,n.useState)(!1),[r,i]=(0,n.useState)({fps:0,cpuUsage:0,memoryUsage:0,gpuUsage:0}),[l,c]=(0,n.useState)(""),[o,d]=(0,n.useState)([]),h=(0,n.useRef)(null),u=(0,n.useRef)(null),m=(0,n.useRef)(null),x=(0,n.useCallback)(()=>{g(),h.current=setInterval(async()=>{if(t)try{let e=await F.getCurrentFrame();e.success&&e.image&&c(e.image)}catch(e){}},100),u.current=setInterval(async()=>{if(t)try{let e=await F.getDetectionResults();e.objects&&d(e.objects)}catch(e){}},200),m.current=setInterval(async()=>{try{let e=await F.getSystemStatus();i({fps:e.fps||0,cpuUsage:e.cpuUsage||0,memoryUsage:e.memoryUsage||0,gpuUsage:e.gpuUsage||0})}catch(e){}},1e3)},[t]),g=(0,n.useCallback)(()=>{h.current&&(clearInterval(h.current),h.current=null),u.current&&(clearInterval(u.current),u.current=null),m.current&&(clearInterval(m.current),m.current=null)},[]);(0,n.useEffect)(()=>{let e=async()=>{try{await F.getSystemStatus(),s(!0)}catch(e){s(!1)}};e();let t=setInterval(e,5e3);return()=>clearInterval(t)},[]),(0,n.useEffect)(()=>(t?x():(h.current&&(clearInterval(h.current),h.current=null),u.current&&(clearInterval(u.current),u.current=null),c(""),d([])),()=>{t||g()}),[t,x,g]),(0,n.useEffect)(()=>()=>{g()},[g]);let p=(0,n.useCallback)(async e=>{try{let s=await F.startCamera(e);return s.success&&a(!0),s}catch(e){throw e}},[]),j=(0,n.useCallback)(async()=>{try{let e=await F.stopCamera();return a(!1),e}catch(e){throw e}},[]),f=(0,n.useCallback)(async e=>{try{return await F.loadModel(e)}catch(e){throw e}},[]),y=(0,n.useCallback)(async e=>{try{return await F.setImageParams(e)}catch(e){throw e}},[]),v=(0,n.useCallback)(async e=>{try{return await F.setRecognitionSettings(e)}catch(e){throw e}},[]),b=(0,n.useCallback)(async()=>{try{return(await F.getDetectionResults()).objects||[]}catch(e){return[]}},[]);return{isConnected:e,isStreaming:t,systemStatus:r,currentFrame:l,detectedObjects:o,startCamera:p,stopCamera:j,loadModel:f,updateImageParams:y,updateRecognitionSettings:v,getDetectionResults:b,saveImage:(0,n.useCallback)(async e=>{try{return await F.saveImage(e)}catch(e){throw e}},[]),exportReport:(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json";try{return await F.exportReport(e)}catch(e){throw e}},[])}}(),[g,p]=(0,n.useState)(!1),[j,f]=(0,n.useState)("0"),[y,v]=(0,n.useState)("./model/best_float32-2.tflite"),[b,N]=(0,n.useState)(!1),[k,M]=(0,n.useState)(!1),[z,T]=(0,n.useState)({basicAdjustment:!1,detectionThreshold:!0,perspectiveTransform:!0,distortionCorrection:!0,cameraIntrinsics:!0,cameraParams:!0,backgroundImage:!0,sizeClassification:!0,realSize:!0}),[A,R]=(0,n.useState)({contrast:100,brightness:100,saturation:100,blur:0,delaySeconds:0,objThresh:10,nmsThresh:10,scoreThresh:0,perspectiveEnabled:!0,srcPoints:{topLeft:{x:510,y:270},topRight:{x:1170,y:270},bottomRight:{x:1500,y:710},bottomLeft:{x:140,y:710}},distortionEnabled:!0,distortionK1:-.430483648,distortionK2:.216393722,distortionP1:-156465611e-12,distortionP2:104551776e-12,distortionK3:-.0564557922,focalLengthX:1260.15281,focalLengthY:1256.08744,principalPointX:971.702426,principalPointY:504.553169,cameraHeight:13,targetHeight:2.7,hamburgerSizeMin:9,hamburgerSizeMax:11.3,hamburgerSizeMjMin:95,hamburgerSizeMjMax:143,realWidthCm:29,realHeightCm:18.5,backgroundImagePath:"./img/bg.jpg"}),[_,L]=(0,n.useState)({foreignObjectDetection:!0,sizeClassification:!0,edgeDetection:!1,colorAnalysis:!1,backgroundChangeDetection:!1,contourDetection:!1,heightCorrection:!0}),[W,D]=(0,n.useState)(!1),[U,B]=(0,n.useState)(!1),[Y,X]=(0,n.useState)(!1),{toasts:O,removeToast:J,showSuccess:Q,showError:G,showInfo:Z}=function(){let[e,s]=(0,n.useState)([]),t=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,n=Math.random().toString(36).substr(2,9),r={id:n,message:e,type:t,duration:a};s(e=>[...e,r]),setTimeout(()=>{s(e=>e.filter(e=>e.id!==n))},a+300)},[]),a=(0,n.useCallback)(e=>{s(s=>s.filter(s=>s.id!==e))},[]),r=(0,n.useCallback)((e,s)=>{t(e,"success",s)},[t]),i=(0,n.useCallback)((e,s)=>{t(e,"error",s)},[t]),l=(0,n.useCallback)((e,s)=>{t(e,"info",s)},[t]);return{toasts:e,addToast:t,removeToast:a,showSuccess:r,showError:i,showInfo:l}}(),$=async e=>{N(!0),v(e);try{await o(e)}catch(e){}finally{N(!1)}},ee=async()=>{D(!0),Z("正在启动摄像头 ".concat(j,"..."));try{let e=await l(j);e.success?(p(!0),Q("摄像头 ".concat(j," 启动成功！"))):G(e.error||"摄像头启动失败")}catch(e){G("摄像头启动失败，请检查设备连接")}finally{D(!1)}},es=async()=>{try{let e=await c();p(!1),e.success&&Z("摄像头已停止")}catch(e){G("停止摄像头失败")}},et=(0,n.useCallback)(async e=>{R(e);try{let s=await d(e);s.success||G(s.error)}catch(e){}},[d]),ea=(0,n.useCallback)(async e=>{L(e);try{await u(e)}catch(e){}},[u]),en=(0,n.useCallback)(e=>{T(s=>({...s,[e]:!s[e]}))},[z]),er=async()=>{B(!0);try{let e=await m();if(e.success){let s=e.message.match(/图像已保存: (.+)/),t=s?s[1]:"未知路径";Q("图像保存成功！\n路径: ".concat(t),5e3)}else G(e.error||"保存图像失败")}catch(e){G("保存图像失败")}finally{B(!1)}},ei=async()=>{X(!0);try{let e=await x("json");if(e.success){let s=e.message.match(/报告已导出: (.+)/),t=s?s[1]:"未知路径";Q("检测报告导出成功！\n路径: ".concat(t),5e3)}else G(e.error||"导出报告失败")}catch(e){G("导出报告失败")}finally{X(!1)}},el=i.length,ec=i.filter(e=>"异物"===e.type||"缺陷"===e.type).length,eo=el>0?i.reduce((e,s)=>e+s.confidence,0)/el*100:0;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 p-4",children:[(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"图像识别系统"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["实时图像处理与智能识别平台 - 主动推送版",s?(0,a.jsx)("span",{className:"ml-2 text-green-600",children:"● Python已连接"}):(0,a.jsx)("span",{className:"ml-2 text-red-600",children:"● Python未连接"})]})]}),(0,a.jsx)(h,{onClick:()=>M(!k),variant:"outline",size:"sm",className:"flex items-center gap-2",children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{className:"w-4 h-4"}),"展开控制面板"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C,{className:"w-4 h-4"}),"收起控制面板"]})})]})}),(0,a.jsxs)("div",{className:"grid gap-6 transition-all duration-300 ".concat(k?"grid-cols-1":"grid-cols-1 lg:grid-cols-4"),children:[(0,a.jsxs)("div",{className:"space-y-4 transition-all duration-300 overflow-hidden ".concat(k?"lg:w-0 lg:opacity-0 lg:pointer-events-none lg:absolute lg:-translate-x-full":"lg:col-span-1 lg:w-auto lg:opacity-100 lg:pointer-events-auto lg:relative lg:translate-x-0"),children:[(0,a.jsx)(S,{currentModelPath:y,modelLoading:b,onModelChange:$}),(0,a.jsx)(P,{selectedCamera:j,isStreaming:g,modelLoading:b,isStarting:W,onCameraChange:f,onStartCamera:ee,onStopCamera:es}),(0,a.jsx)(V,{imageParams:A,collapsedSections:z,onParamsChange:et,onToggleSection:en,onResetParams:()=>{et({contrast:100,brightness:100,saturation:100,blur:0,delaySeconds:0,objThresh:10,nmsThresh:10,scoreThresh:0,perspectiveEnabled:!0,srcPoints:{topLeft:{x:510,y:270},topRight:{x:1170,y:270},bottomRight:{x:1500,y:710},bottomLeft:{x:140,y:710}},distortionEnabled:!0,distortionK1:-.430483648,distortionK2:.216393722,distortionP1:-156465611e-12,distortionP2:104551776e-12,distortionK3:-.0564557922,focalLengthX:1260.15281,focalLengthY:1256.08744,principalPointX:971.702426,principalPointY:504.553169,cameraHeight:13,targetHeight:2.7,hamburgerSizeMin:9,hamburgerSizeMax:11.3,hamburgerSizeMjMin:95,hamburgerSizeMjMax:143,realWidthCm:29,realHeightCm:18.5,backgroundImagePath:"./img/bg.jpg"})}}),(0,a.jsx)(E,{settings:_,onSettingsChange:ea})]}),(0,a.jsxs)("div",{className:"space-y-4 transition-all duration-300 ".concat(k?"col-span-1":"lg:col-span-3"),children:[(0,a.jsx)(I,{ref:e,isStreaming:g,modelLoading:b,currentFrame:r,isSaving:U,onSaveImage:er}),(0,a.jsx)(H,{objects:i,isExporting:Y,onExportReport:ei}),(0,a.jsx)(K,{objectCount:el,anomalyCount:ec,averageConfidence:eo,fps:t.fps,isStreaming:g})]})]})]}),(0,a.jsx)(q,{toasts:O,onRemoveToast:J})]})}n.forwardRef((e,s)=>{let{className:t,variant:n,...r}=e;return(0,a.jsx)(U.bL,{ref:s,className:A(X({variant:n}),t),...r})}).displayName=U.bL.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(U.rc,{ref:s,className:A("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...n})}).displayName=U.rc.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(U.bm,{ref:s,className:A("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...n,children:(0,a.jsx)(Y.A,{className:"h-4 w-4"})})}).displayName=U.bm.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(U.hE,{ref:s,className:A("text-sm font-semibold",t),...n})}).displayName=U.hE.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(U.VY,{ref:s,className:A("text-sm opacity-90",t),...n})}).displayName=U.VY.displayName},9818:(e,s,t)=>{Promise.resolve().then(t.bind(t,2118))}},e=>{var s=s=>e(e.s=s);e.O(0,[57,22,575,358],()=>s(9818)),_N_E=e.O()}]);